#!/bin/bash

set -e

resources_pkg=code.cloudfoundry.org/cli/cf/resources
docker_pkg=github.com/docker/docker

docker_url=https://github.com/docker/docker-ce/archive/v17.12.0-ce.tar.gz

cd $(dirname "${BASH_SOURCE[0]}")/..

dep ensure
dep prune

mkdir -p "vendor/${resources_pkg}"
cp -f assets/i18n_resources.go "vendor/${resources_pkg}/"

tmp_dir=$(mktemp -d)
curl -sSL "$docker_url" | tar -C "${tmp_dir}" -xz --strip-components=3 docker-ce-17.12.0-ce/components/engine
rm -rf engine/vendor
mv "${tmp_dir}/vendor" engine/
mkdir -p "$(dirname "engine/vendor/${docker_pkg}")"
mv "${tmp_dir}" "engine/vendor/${docker_pkg}"


